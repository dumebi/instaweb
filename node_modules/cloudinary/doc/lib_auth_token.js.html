<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/auth_token.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/auth_token.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Generated by CoffeeScript 1.12.2

/**
  * Authorization Token
  * @module auth_token
 */

(function() {
  var config, crypto, digest;

  crypto = require('crypto');

  config = require('./config');

  digest = function(message, key) {
    return crypto.createHmac("sha256", new Buffer(key, "hex")).update(message).digest('hex');
  };


  /**
    * Generate an authorization token
    * @param {Object} options
    * @param {string} options.key - the secret key required to sign the token
    * @param {string} [options.ip] - the IP address of the client
    * @param {number} [options.start_time=now] - the start time of the token in seconds from epoch
    * @param {string} [options.expiration] - the expiration time of the token in seconds from epoch
    * @param {string} [options.duration] - the duration of the token (from start_time)
    * @param {string} [options.acl] - the ACL for the token
    * @param {string} [options.url] - the URL to authentication in case of a URL token
    * @returns {string} the authorization token
   */

  module.exports = function(options) {
    var auth, params, part, ref, ref1, start, toSign, tokenName, tokenParts, url;
    params = Object.assign({}, config().auth_token, options);
    tokenName = (ref = params.token_name) != null ? ref : "__cld_token__";
    if (params.expiration == null) {
      if (params.duration != null) {
        start = (ref1 = params.start_time) != null ? ref1 : Math.round(Date.now() / 1000);
        params.expiration = start + params.duration;
      } else {
        throw new Error("Must provide either end_time or window");
      }
    }
    tokenParts = [];
    if (params.ip != null) {
      tokenParts.push("ip=" + params.ip);
    }
    if (params.start_time != null) {
      tokenParts.push("st=" + params.start_time);
    }
    tokenParts.push("exp=" + params.expiration);
    if (params.acl != null) {
      tokenParts.push("acl=" + params.acl);
    }
    toSign = (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = tokenParts.length; i &lt; len; i++) {
        part = tokenParts[i];
        results.push(part);
      }
      return results;
    })();
    if (params.url) {
      url = encodeURIComponent(params.url).replace(/%../g, function(match) {
        return match.toLowerCase();
      });
      toSign.push("url=" + url);
    }
    auth = digest(toSign.join("~"), params.key);
    tokenParts.push("hmac=" + auth);
    return tokenName + "=" + (tokenParts.join('~'));
  };

}).call(this);

//# sourceMappingURL=auth_token.js.map
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-auth_token.html">auth_token</a></li><li><a href="module-utils.html">utils</a></li><li><a href="module-utils.html#.generate_auth_token">generate_auth_token</a></li></ul><h3>Global</h3><ul><li><a href="global.html#option_consume">option_consume</a></li><li><a href="global.html#video">video</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Feb 15 2017 11:30:45 GMT+0200 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
